import pandas as pd

# -------------------------------------------------------
# 1. ??쇱젟: ??쇱뜖??뺥?[燁삳똾?믤⑥쥓?? ?온???린?? 筌띲끋釉??類ㅼ벥
# -------------------------------------------------------
# ?類ㅻ뻼: "??쇱뜖??: ("???브쑬履?, "??녿궢")

keyword_map = {
    # 2016??
    #"??곴쉭??: ("IT/?⑥눛釉?, "?뚮똾踰?怨뚮궗??녿궢"),
    #"野껋럩竊?筌왖筌?: ("??????됱읈", "筌왖?닌뗭넎野껋럡???녿궢"),
    #"揶쎛???┛ ??욱뇧??: ("????癰귣떯援?, "?酉釉경⑤벏釉경?), 
    #"???놅쭗?GO": ("IT/?얜챸??, "野껊슣?ヨ굜?묐쀯㎘醫뤿린??), 
    #"筌왖燁?獄쏅뗄?????: ("??롮┷/癰귣떯援?, "揶쏄쑵???녿궢"),  
    
    # 2017??
    #"4筌△뫁沅??뉗겫筌?: ("IT/?⑥눛釉?, "?뚮똾踰?怨뚮궗??녿궢"),
    #"沃섎챷苑?솒??": ("??????띻펾", "??띻펾?⑤벏釉경?),
    #"??쑵?껇굜遺우뵥": ("野껋럩??IT", "野껋럩???녿궢"),
    #"??됱뜚??: ("?????癒?섐筌왖", "?癒?섐筌왖?⑤벏釉경?),
    #"??鍮놅쭪?筌?: ("??????沅?, "椰꾨똻?욄⑤벏釉경?)
        
}

# -------------------------------------------------------
# 2. ?怨쀬뵠??嚥≪뮆諭?
# -------------------------------------------------------
# ??굞萸?紐꾩グ?癒?퐣 ??쇱뒲嚥≪뮆諭?獄쏆룇? ?臾? ???뵬筌???낆젾
file_path = '??쇱뜖???臾? ???뵬.xlsx' 

df = pd.read_excel(file_path)

print(f"?癒?궚 ?怨쀬뵠??嚥≪뮆諭??袁⑥┷: {len(df)}椰?)

# -------------------------------------------------------
# 3. ?袁⑹퓗??獄??怨쀬뵠???곕뗄??嚥≪뮇彛?
# -------------------------------------------------------

# (1) ?醫롮? 癰궰??(YYYYMMDD -> YYYY-MM)
df['??깆쁽'] = df['??깆쁽'].astype(str)
df['Date'] = pd.to_datetime(df['??깆쁽'], format='%Y%m%d').dt.to_period('M')

results = []

# (2) ??쇱뜖??뺥??룐뫂遊?
for keyword, (category, dept) in keyword_map.items():
    # ??????쇱뜖??? ??釉??疫꿸퀣沅??袁り숲筌?(??쇱뜖???뚎됱쓥 or ??뺛걠)
    mask = (
        df['??쇱뜖??].str.contains(keyword, na=False) | 
        df['??뺛걠'].str.contains(keyword, na=False)
    )
    filtered_df = df[mask]
    
    # ?遺얩???뜄猷???④쑴沅?
    monthly_counts = filtered_df.groupby('Date').size()
    
    # 野껉퀗???귐딅뮞?紐꾨퓠 ?곕떽?
    for date, count in monthly_counts.items():
        results.append({
            'Date': str(date),       # ?? 2016-03
            'Keyword': keyword,      # ?? AlphaGo
            'Category': category,    # ?? IT/?⑥눛釉?
            'Department': dept,      # [NEW] ?? ?뚮똾踰?怨뚮궗??녿궢
            'Count': count           # ?? 521
        })

# -------------------------------------------------------
# 4. ????
# -------------------------------------------------------
final_df = pd.DataFrame(results)

# ?뚎됱쓥 ??뽮퐣 ?類ｌ졊 (癰귣떯由??ル뿪苡?
final_df = final_df[['Date', 'Keyword', 'Category', 'Department', 'Count']]

# CSV ????
output_filename = '??쇱뜖???곕뗄?㎬눧?csv'
final_df.to_csv(output_filename, index=False, encoding='utf-8-sig')

print(f"\n[?袁⑥┷] ??{len(final_df)}揶쏆뮇???遺얩??怨쀬뵠?怨? ??밴쉐??뤿???щ빍??")
print(f"???뵬 ???貫留? {output_filename}")
print("\n--- ?怨쀬뵠??沃섎챶?곮퉪?용┛ ---")
print(final_df.head())